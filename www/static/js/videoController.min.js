var FactoryMediaController=function(){};FactoryMediaController.prototype.constructor=FactoryMediaController;FactoryMediaController.prototype.getNewMediaController=function(a){return document.webkitFullscreenEnabled?new WebkitMediaController(a):document.mozFullScreenEnabled?new GeckoMediaController(a):document.msFullscreenEnabled?new IEMediaController(a):new GenericMediaController(a)};
function GenericMediaController(a){this.id=a;this.media=document.getElementById(a);this.$media=$(this.media);this.$media.is("video")?this.type="video":this.$media.is("audio")&&(this.type="audio");this.engine="unknown";this.controls={};this.controls.override={};this.components={};this.currentSubIndex=0;this.setEvents();debug&&console.log(this)}GenericMediaController.prototype.constructor=GenericMediaController;
GenericMediaController.prototype.stop=function(){this.media.pause();this.media.currentTime=0};GenericMediaController.prototype.play=function(){this.isPlaying()||this.media.play()};GenericMediaController.prototype.mute=function(){this.isMuted()?(volume=document.querySelector(this.controls.volume).value,this.setVolume(parseFloat(volume))):this.setVolume(0)};GenericMediaController.prototype.pause=function(){this.isPlaying()&&this.media.pause()};
GenericMediaController.prototype.toString=function(){return this.media.toString()+this.engine};GenericMediaController.prototype.isMuted=function(){return 0==this.media.volume};GenericMediaController.prototype.isPlaying=function(){return!this.media.paused};GenericMediaController.prototype.isFullscreen=function(){return this.container===document.fullscreenElement};GenericMediaController.prototype.hasAutoPlay=function(){return void 0!=this.$media.attr("autoplay")};
GenericMediaController.prototype.getSize=function(){return[this.getHeight(),this.getWidth()]};
GenericMediaController.prototype.getWidth=function(){var a=this.$media.css("width"),b=this.$media.css("border-left-width"),d=this.$media.css("border-right-width"),c=this.$media.css("padding-left"),f=this.$media.css("padding-right"),e=this.$media.css("margin-left"),g=this.$media.css("margin-right"),a=parseInt(a.substr(0,a.indexOf("px"))),b=b.substr(0,b.indexOf("px")),d=d.substr(0,d.indexOf("px")),c=c.substr(0,c.indexOf("px")),f=f.substr(0,f.indexOf("px")),e=e.substr(0,e.indexOf("px")),g=g.substr(0,
g.indexOf("px")),b=parseInt(d)+parseInt(b),c=parseInt(f)+parseInt(c),e=parseInt(g)+parseInt(e);return a+e+c+b};
GenericMediaController.prototype.getHeight=function(){var a=this.$media.css("height"),b=this.$media.css("border-top-width"),d=this.$media.css("border-bottom-width"),c=this.$media.css("padding-top"),f=this.$media.css("padding-bottom"),e=this.$media.css("margin-top"),g=this.$media.css("margin-bottom"),a=parseInt(a.substr(0,a.indexOf("px"))),b=b.substr(0,b.indexOf("px")),d=d.substr(0,d.indexOf("px")),c=c.substr(0,c.indexOf("px")),f=f.substr(0,f.indexOf("px")),e=e.substr(0,e.indexOf("px")),g=g.substr(0,
g.indexOf("px")),b=parseInt(d)+parseInt(b),c=parseInt(f)+parseInt(c),e=parseInt(g)+parseInt(e);return a+e+c+b};GenericMediaController.prototype.getDuration=function(){return this.media.duration};GenericMediaController.prototype.getCurrentTime=function(){return this.media.currentTime};
GenericMediaController.prototype.getStringTime=function(){var a=parseInt(this.getCurrentTime()),b=Math.floor(a/3600),a=a-3600*b,d=Math.floor(a/60),a=a-60*d,c="",c=10>d?c+(0+d.toString()):c+d.toString(),c=10>a?c+(":0"+a.toString()):c+(":"+a.toString());0<b&&(c=b+":"+c);return c};GenericMediaController.prototype.setTime=function(a){this.media.currentTime=a};
GenericMediaController.prototype.setEvents=function(){var a=this;if(!this.controls.override.play)this.$media.on("play",function(b){$(a.controls.play).hide();$(a.controls.pause).show()});if(!this.controls.override.pause)this.$media.on("pause",function(b){$(a.controls.play).show();$(a.controls.pause).hide()});if(!this.controls.override.volume)this.$media.on("volumechange",function(b){0==a.media.volume?($(a.controls.mute).children().hide(),$(a.controls.mute).children(".no-volume").show()):0<a.media.volume&&
1>a.media.volume?($(a.controls.mute).children().hide(),$(a.controls.mute).children(".half-volume").show()):($(a.controls.mute).children().hide(),$(a.controls.mute).children(".high-volume").show())});this.$media.on("timeupdate",function(b){a.controls.seekBar&&$(a.controls.seekBar).val(a.getCurrentTime()/a.getDuration());a.controls.timer&&(a.getStringTime(),$(a.controls.timer).text(a.getStringTime()));a.components.subs&&a.updateSubs()});this.$media.on("keypress",function(b){if(32===b.which)return a.isPlaying()?
a.pause():a.play(),b.preventDefault(),b.stopPropagation(),!1;39===b.keyCode?(b=a.getCurrentTime(),a.setTime(b+5)):37===b.keyCode&&(b=a.getCurrentTime(),a.setTime(b-5))});this.$media.click(function(b){if(1===b.which)return a.isPlaying()?a.pause():a.play(),b.preventDefault(),!1})};GenericMediaController.prototype.setVolume=function(a){this.media.volume=a};GenericMediaController.prototype.setContainer=function(a){this.container=document.querySelector(a);this.$container=$(a)};
GenericMediaController.prototype.setFullScreen=function(){document.fullscreenEnabled?(this.container.requestFullscreen(),this.$container.css("background-color","black"),this.$container.addClass("fullscreen")):this.$media.addClass("fullscreen")};GenericMediaController.prototype.exitFullScreen=function(){document.fullscreenEnabled?document.exitFullscreen():this.$media.removeClass("fullscreen")};
GenericMediaController.prototype.addControl=function(a,b,d){d=void 0===d?!1:d;if($(a)){var c=this;switch(b){case "play":$(a).click(function(){c.play()});this.controls.play=a;this.controls.override.play=d;this.hasAutoPlay()&&$(this.controls.play).hide();break;case "pause":$(a).click(function(){c.pause()});this.hasAutoPlay()||$(this.controls.pause).hide();this.controls.pause=a;this.controls.override.pause=d;break;case "stop":$(a).click(function(){c.stop()});this.controls.stop=a;break;case "seekBar":$(a).on("mousedown",
function(a){c.isPlaying()&&$(this).data("replay",!0);c.pause()});$(a).on("mouseup",function(a){$(this).data("replay")&&c.play()});$(a).on("change",function(a){c.setTime(c.getDuration()*this.value)});this.controls.seekBar=a;break;case "timer":this.controls.timer=a;break;case "fullscreen":$(a).click(function(){c.isFullscreen()?c.exitFullScreen():c.setFullScreen()});this.controls.fullscreen=a;this.controls.override.fullscreen=d;break;case "mute":$(a).click(function(){c.mute()});this.controls.mute=a;
this.controls.override.mute=d;d||($(this.controls.mute).children().hide(),$(this.controls.mute).children(".high-volume").show());break;case "volume":$(a).on("change",function(a){c.setVolume(this.value)});volume=document.querySelector(a).value;this.setVolume(parseFloat(volume));this.controls.volume=a;break;case "subs":$(a).click(function(){c.toggleSubs()}),this.controls.subs=a}}};GenericMediaController.prototype.addComponent=function(a,b){if($(a))switch(b){case "subs":this.components.subs=a}};
GenericMediaController.prototype.updateSubs=function(){var a=this,b=this.getCurrentTime();$.each($(".sub"),function(d,c){if(d<this.currentSubIndex)return!0;var f=parseFloat($(this).data("init")),e=parseFloat($(this).data("end"));f<=b&&e>=b&&($(".sub").hide(),$(this).show(),a.currentSubIndex=d)})};GenericMediaController.prototype.toggleSubs=function(){$(this.components.subs).is(":visible")?$(this.components.subs).hide():$(this.components.subs).show()};
function WebkitMediaController(a){GenericMediaController.call(this,a);this.engine="webkit"}WebkitMediaController.prototype=Object.create(GenericMediaController.prototype);WebkitMediaController.prototype.setFullScreen=function(){this.container.webkitRequestFullScreen();this.$container.addClass("fullscreen")};WebkitMediaController.prototype.exitFullScreen=function(){document.webkitExitFullscreen();this.$container.removeClass("fullscreen")};
WebkitMediaController.prototype.isFullscreen=function(){return this.container===document.webkitFullscreenElement};function GeckoMediaController(a){GenericMediaController.call(this,a);this.engine="Gecko"}GeckoMediaController.prototype=Object.create(GenericMediaController.prototype);GeckoMediaController.prototype.setFullScreen=function(){this.container.mozRequestFullScreen();this.$container.addClass("fullscreen")};
GeckoMediaController.prototype.exitFullScreen=function(){document.mozCancelFullScreen();this.$container.removeClass("fullscreen")};GeckoMediaController.prototype.isFullscreen=function(){return this.container===document.mozFullScreenElement};function IEMediaController(a){GenericMediaController.call(this,a);this.engine="MS"}IEMediaController.prototype=Object.create(GenericMediaController.prototype);IEMediaController.prototype.setFullScreen=function(){this.container.msRequestFullscreen();this.$container.addClass("fullscreen")};
IEMediaController.prototype.exitFullScreen=function(){document.msExitFullscreen();this.$container.css("background-color","black")};IEMediaController.prototype.isFullscreen=function(){return this.container===document.msFullscreenElement};window.Factory=new FactoryMediaController;
